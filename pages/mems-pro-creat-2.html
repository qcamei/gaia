<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>mems-创建项目</title>
    <link href="../css/creat-pro.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<!--header-->
<header id="header" class="header" v-html="datas">
    <div>{{datas}}</div>
</header>

<!--menu-->
<aside class="aside">
    <div class="logo">
        运营平台
    </div>
    <ul class="menu">
        <li>
            <div class="menu-first"><i class="dash"></i>Dashboard<l></l></div>
        </li>
        <li>
            <div class="menu-first current" ><i class="project"></i>项目管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="#">待办事项</a></dd>
                <dd><a href="mems-pro-list.html">项目列表</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="need"></i>需求管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="pm-need-list.html" >需求池</a></dd>
                <dd><a href="pm-bug-list.html">缺陷池</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first current"><i class="system"></i>系统配置<l></l></div>
            <dl class="menu-second">
                <dd><a href="user-manage.html" >用户管理</a></dd>
                <dd><a href="organize-architecture.html" >组织架构</a></dd>
                <dd><a href="tag-manage.html" class="current">标签管理</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="project"></i>文档管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="doc-manage.html">文档管理</a></dd>
            </dl>
        </li>
    </ul>
</aside>

<!--content-->
<div class="content">
    <div class="page-header">
        <div class="header-info"><i></i><a href="mems-pro-creat.html">创建项目</a></div>
    </div>
    <div class="creat-pro">
        <div class="pro-head"><i></i>创建项目</div>
        <div class="steps">
            <div class="line">
                <i class="done"></i>
                <i></i>
            </div>
            <div class="circle">
                <p class="done">1</p><p class="done">2</p><p>3</p>
            </div>
            <div class="s-d">
                <p class="done">选择医院</p><p class="done">完善信息</p><p>完成</p>
            </div>
        </div>

        <table class="pro-table">
            <thead>
                <tr>
                    <th width="100">基本信息</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="red-start">*</span>医院全称</td>
                    <td><input type="" name="" id="name"></td>
                </tr>
                <tr>
                    <td>简称</td>
                    <td><input type="" name="" id="shortName"></td>
                </tr>
                <tr>
                    <td>别称</td>
                    <td><input type="" name="" id="alias"></td>
                </tr>
                <tr>
                    <td><span class="red-start">*</span>Segmentation</td>
                    <td><select id="segmentation"></select></td>
                </tr>
                <tr>
                    <td><span class="red-start">*</span>级别</td>
                    <td><select id="level"></select></td>
                </tr>

                <tr>
                    <td><span class="red-start">*</span>有无高铁</td>
                    <td><label><input type="radio" value="1" name="hsrEnable">&nbsp;有</label>&emsp;<label><input type="radio" name="hsrEnable" checked="checked" value="0">&nbsp;无</label></td>
                </tr>
                <tr>
                    <td>邮编</td>
                    <td><input type="" name="" class="short" id="postcode"></td>
                </tr>
                <tr>
                    <td>床位</td>
                    <td>
                        <div class="clearfix number">
                        <a href="javascript:;" class="left sub">-</a>
                        <input onchange="this.value=(this.value+'').replace(/\D/g,'');"  class="left" value="1" id="bed">
                        <a class="left add">+</a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>年诊疗人次</td>
                    <td><input type="" name="" class="short" id="people"></td>
                </tr>
                
            </tbody>
            <thead>
                <tr>
                    <th width="100">地址信息</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="red-start">*</span>所属区域</td>
                    <td><select id="district"><option>请选择</option></select>&emsp;<select id="province"><option>请选择</option></select>&emsp;<select id="city"><option>请选择</option></select></td>
                </tr>
                <tr>
                    <td><span class="red-start">*</span>地址</td>
                    <td><input type="" name="" class="short" id=""></td>
                </tr>
                <tr>
                    <td>设备科位置</td>
                    <td><input type="" name="" class="short" id="location"></td>
                </tr>
                <tr>
                    <td>维度</td>
                    <td><input type="" name="" class="short" id="latitude"></td>
                </tr>
                <tr>
                    <td>经度</td>
                    <td><input type="" name="" class="short" id="longitude"></td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td></td>
                    <td><a class="pro-btn" href="mems-pro-list.html">取消</a>&emsp;<a class="pro-btn pro-sure" onclick="creatItem()">提交</a></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<script src='../js/jquery.min.js'  type="text/javascript"></script>
<script src="../js/vue.js" type="text/javascript"></script>
<script src="../js/common.js"></script>

<script type="text/javascript">
    _API.getNeedSource('needSource')
        .getPSegmentationList('segmentation')
        .getPLevelList('level')
        .dynamicDistrick('district','province','city');

    var arr = ['name','location'];
    for(var k = 0; k < 2; k ++){
        $('#'+arr[k]).focus(function(){
            $(this).removeClass('error-i');
        })
    }
    function creatItem() {
        for(var k = 0; k < 2; k ++){
            var v = $('#'+arr[k]).val();
            if(v == ""){
               $('#'+arr[k]).addClass('error-i'); 
               break;
            }
        }

        var url  = _ip+'/project/insert';
        var data = {
            "name": $('#name').val(),
            "shortName":$('#shortName').val(),
            "alias":$('#alias').val(),
            "segmentation": $('#segmentation').val(), 
            "level": $('#level').val(), 
            "hsrEnable":parseInt($('input[name=hsrEnable]').val()),
            "postcode":parseInt($('#postcode').val()),
            "bed":parseInt($('#bed').val()),
            "people":parseInt($('#people').val()),
            "province": $('#province').val || 'p', 
            "city": $('#city').val() || 'c', 
            "area": $('#area').val() || 'a', 
            "creater": 11
        }

        $.ajax({
            url:url,
            type : "POST",
            xhrFields: {
               withCredentials: true
            },
            crossDomain: true,
            dataType: 'json',
            contentType:'application/json',
            data:JSON.stringify(data),
            success:function(data){

                if(json.message === 'LOGIN') {
                    window.location.href = 'user-login.html';
                    return false;
                }

                if(data.success){
                    location.href = 'mems-pro-list.html';
                }else{
                    alert('创建失败, 请稍后重试！');
                }
            }
        })
   }
</script>
</body>
</html>