<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pm-需求-产品需求详情</title>
    <link href="../css/list-detial.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<!--header-->
<header id="header" class="header clear" v-html="datas">
    <div>{{datas}}</div>
</header>

<!--menu-->
<aside id="aside" class="aside" v-html="datas">
    <div>{{datas}}</div>
</aside>
<!-- <aside class="aside">
    <div class="logo">
        运营平台
    </div>
    <ul class="menu">
        <li>
            <div class="menu-first"><i class="dash"></i>Dashboard<l></l></div>
        </li>
        <li>
            <div class="menu-first"><i class="project"></i>项目管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="#">待办事项</a></dd>
                <dd><a href="projectManage/mems-pro-list.html">项目列表</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first current"><i class="need"></i>需求管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="pm-need-list.html">需求池</a></dd>
                <dd><a href="pm-bug-list.html" class="current">缺陷池</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="system"></i>系统配置<l></l></div>
        </li>
    </ul>
</aside> -->

<!--content-->
<div class="content">
    <div class="page-header">
        <div class="header-info"><i></i><a href="#">pm-需求列表</a>&nbsp;>&nbsp;产品需求详情</div>
    </div>
    <div class="page-inner">
        <div class="page-content">
            <div class="table-head clear"><div class="left document-name"><i class="bug-i"></i>No.01234</div><div class="right edit"><a onclick="edit()" class="sure">编辑</a></div></div>
            <div class="table-cont">
                <table class="content-table">
                    
                    <tr>
                        <td>需求类别：</td>
                        <td id="typeList"></td>
                        <td>产品:</td>
                        <td id="productList"></td>
                    </tr>
                    <tr>
                        <td>使用平台：</td>
                        <td id="platformList"></td>
                        <td>功能模块：</td>
                        <td id="functionList"></td>
                    </tr>

                    <tr>
                        <td>需求名称：</td>
                        <td id="needName">合同到期提醒</td>
                        <td>优先级：</td>
                        <td id="priority"></td>
                    </tr>
                    <tr>
                        <td>计划版本：</td>
                        <td id="version"></td>
                        <td>处理状态：</td>
                        <td id="status"></td>
                    </tr>
                    <tr>
                        <td>简述：</td>
                        <td colspan="3" id="discribe"></td>
                    </tr>

                    <tr class="area">
                        <td>方案思路：</td>
                        <td colspan="3" id="solution">
                            
                        </td>
                    </tr>
                    <tr class="area">
                        <td>附件：</td>
                        <td colspan="3">
                             <ul class="addAttachmentList" id="addAttachmentList">
                            </ul>
                        </td>
                    </tr>

                </table>
            </div>

            <div class="table-head clear"><div class="left document-name"><i class="bug-i"></i>相关原始需求</div></div>
            <div class="table-cont">
                <table class="relative-list">
                    <thead>
                        <tr>
                            <th>来源</th>
                            <th>需求方</th>
                            <th>需求信息</th>
                            <th>紧急程度</th>
                            <th>处理状态</th>
                           
                        </tr>
                    <thead>
                     <tbody id="relativeList">
                       
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="../js/jquery.min.js"></script>
<script src="../js/jquery.cookie.js"></script>
<script src="../js/vue.js" type="text/javascript"></script>
<script src="../js/common.js"></script>

<script type="text/javascript">

    var _id = getUrlId();
    
    function edit(){
        location.href = 'pm-need-detail-pm-edit.html?id='+_id;
    }

    function updata(){
        var url  = _ip+'/product/getRequireById?callback=update&id='+_id;
        $.ajax({
            url:url,
            type: 'GET',
            dataType: 'jsonp',
            contentType:'application/json',
            jsonpCallback: 'update',
            success:function(data){
                if(data.success){
                    var data = data.data;
                    $('#needName').html(data.name);
                    $('#typeList').html(data.type);
                    $('#productList').html(data.product);
                    $('#platformList').html(data.plat);
                    $('#functionList').html(data.feature);
                    $('#priority').html(data.priority)
                    $('#version').html(data.version);
                    $('#status').html(data.status);
                    $('#discribe').html(data.discribe);
                    $('#solution').html(data.solution);
                    if(data.attachment){
                        attachment.init({
                            addAttachmentList:$('#addAttachmentList'),
                            isDetail:true
                        }).getAttachmentList(data.attachment.split(',')); 
                    }

                }else{
                    alert('获取失败, 请稍后重试！');
                }
            }
        })
    }
    updata();

    getRelativList();
    function getRelativList(){
        var url  = _ip+'/requireRelation/getRequireRelationByPid?pid='+_id;        
        $.ajax({
            url:url,
            type: 'GET',
            dataType: 'jsonp',
            contentType:'application/json',
            jsonpCallback: 'off',
            success:function(data){
                var data = data.data;
                var h = '';

                for(var k = 0; k < data.length; k++){
                    h += '<tr><td>'+data[k].pName+'</td>';
                        h += '<td>'+data[k].customerName+'</td>';
                        h += '<td><a href="pm-need-detail-mems.html?id='+data[k].id+'">'+( data[k].productName + '&nbsp;|&nbsp;' + data[k].feature+ '&nbsp;|&nbsp;' +(data[k].name || '')    )+'</a></td>';
                        h += '<td>'+data[k].priority+'</td>';
                        h += '<td>'+data[k].status+'</td>';
                }
                $('#relativeList').html(h);
            }
        })
    }
    
</script>
</body>
</html>