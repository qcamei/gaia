<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>mems-创建项目</title>
    <link href="../css/creat-pro.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<!--header-->
<header id="header" class="header" v-html="datas">
    <div>{{datas}}</div>
</header>

<!--menu-->
<aside class="aside">
    <div class="logo">
        运营平台
    </div>
    <ul class="menu">
        <li>
            <div class="menu-first"><i class="dash"></i>Dashboard<l></l></div>
        </li>
        <li>
            <div class="menu-first current" ><i class="project"></i>项目管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="#">待办事项</a></dd>
                <dd><a href="mems-pro-list.html">项目列表</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="need"></i>需求管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="pm-need-list.html" >需求池</a></dd>
                <dd><a href="pm-bug-list.html">缺陷池</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="system"></i>系统配置<l></l></div>
            <dl class="menu-second">
                <dd><a href="user-manage.html" >用户管理</a></dd>
                <dd><a href="organize-architecture.html" >组织架构</a></dd>
                <dd><a href="tag-manage.html" class="current">标签管理</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="project"></i>文档管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="doc-manage.html">文档管理</a></dd>
            </dl>
        </li>
    </ul>
</aside>

<!--content-->
<div class="content"  style="height: 100%;">
    <div class="page-header">
        <div class="header-info"><i></i><a href="mems-pro-creat.html">创建项目</a></div>
    </div>
    <div class="creat-pro" style="height: 80%;">
        <div class="pro-head"><i></i>创建项目</div>
        <div class="steps">
            <div class="line">
                <i></i>
                <i></i>
            </div>
            <div class="circle">
                <p class="done">1</p><p>2</p><p>3</p>
            </div>
            <div class="s-d">
                <p class="done">选择医院</p><p>完善信息</p><p>完成</p>
            </div>
        </div>

        <div class="search-box">
            <h3>选择医院</h3>
            <div class="search-input">
                <input type="text" name="" id="serchkeywords">
            </div>
            <div class="show-box"  style="display: none;overflow-y:scroll;" id="showkeylist">
                <ul class="key-list" id="keyul">
                没有匹配到！
                </ul>
            </div>

            <div class="show-box" style="display: none;" id="showselect">
                <div class="select-area clear">
                    <div class="wap">
                        <ul id="district">
                        </ul>
                    </div>

                    <div class="wap">
                        <ul id="provice">
                        </ul>
                    </div>
                    <div class="wap">
                        <ul id="city">
                           
                        </ul>
                    </div>
                    <div class="wap">
                        <ul id="hospital">
                        </ul>
                    </div>
                </div>
            </div>

            <div class="btns">
                <a class="pro-btn pro-sure" onclick="nextStep()">下一步</a>
            </div>
            <div>医院未找到？&emsp;<a class="pro-btn" href="mems-pro-creat-2.html">直接创建</a></div>
        </div>
    </div>
</div>
<script src="../js/vue.js" type="text/javascript"></script>
<script src="../js/jquery.min.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript">


function getDistrictdom(id){
    var _id = $('#'+id);
    $.ajax({
        url:_ip+'/common/getDistrict',
        type: 'GET',
        dataType: 'jsonp',
        contentType:'application/json',
        jsonpCallback: 'getDistrict',
        success: function(json) {
            var json = json.data;
            var h = '';
            for(var k = 0 , kk = json.length; k < kk; k++){
                h += '<li>'+json[k]+'<input type="hidden" value="'+json[k]+'"/><i>></i></li>'
            }            
            _id.html(h);
            _id.on('click','li',function(){
                var d = $(this).find('input').val();
                $(this).addClass('current');
                $(this).siblings().removeClass('current');
                getProvicedom('provice',d);
                $('#serchkeywords').val(d);
            })
        }
    })
}
function getProvicedom(id,area){
    $.ajax({
        url:_ip+'/common/getPrivence?area='+area,
        type: 'GET',
        dataType: 'jsonp',
        contentType:'application/json',
        jsonpCallback: 'getprovice',
        success: function(json) {
            var json = json.data;
            var h = '';
            for(var k = 0 , kk = json.length; k < kk; k++){
                h += '<li>'+json[k]+'<input type="hidden" value="'+json[k]+'"/><i>></i></li>'
            }            
            $('#'+id).html(h);
        }
    })
}
function getCity(id,provice,area){
    $.ajax({
        url:_ip+'/common/getCity?area='+area+'&privence='+provice,
        type: 'GET',
        dataType: 'jsonp',
        contentType:'application/json',
        jsonpCallback: 'getcity',
        success: function(json) {
            var json = json.data;
            var h = '';
            for(var k = 0 , kk = json.length; k < kk; k++){
                h += '<li>'+json[k]+'<input type="hidden" value="'+json[k]+'"/><i>></i></li>'
            }           
            $('#'+id).html(h);
        }
    })
}

function getHospital(id,city){
    var data= {};
    data['city'] = city;
    $.ajax({
        url:_ip+'/hospital/getHospitalList',
        type: 'POST',
        xhrFields: {
           withCredentials: true
        },
        crossDomain: true,
        dataType: 'json',
        contentType:'application/json',
        data:JSON.stringify(data),
        success: function(json) {

            if(json.message === 'LOGIN') {
                window.location.href = 'user-login.html';
                return false;
            }


            var json = json.data;
            var h = '';
            console.log(json);
            for(var k = 0 , kk = json.length; k < kk; k++){
                h += '<li>'+json[k].chineseName+'<i>></i></li>'
            }            
            $('#'+id).html(h);
        }
    })
}


getDistrictdom('district');
$('#provice').on('click','li',function(){
    $(this).addClass('current');
    $(this).siblings().removeClass('current');
    var a,p;
    $('#district').find('li').each(function(){
        if($(this).hasClass('current')){
            a = $(this).find('input').val();
        }
    })
    p = $(this).find('input').val();

    $('#serchkeywords').val( $('#serchkeywords').val() + '/' + p );

    getCity('city',p,a);
})
$('#city').on('click','li',function(){
    var c = $(this).find('input').val();
    $('#serchkeywords').val( $('#serchkeywords').val() + '/' + c);
    getHospital('hospital',c);
})












    var showkeylist = $('#showkeylist');
    var showselect  = $('#showselect');
    $('#serchkeywords').on('focus',function(){
        var s = showkeylist.css('display');
        if(s == 'block'){
            showkeylistdo()
        }else{
            showselectarea()
        }
    })
    .on('keyup',function(){
        var v = $(this).val();
        if(v.length >= 1){
            showkeylistdo()
            // keysearch(v);
            if(v.length >= 5){
                keysearch(v);
            }
            
        }else{
            showselectarea()
        }
    })

    function showkeylistdo(){
        showselect.css({'display':'none'});
        showkeylist.css({'display':'block'});
    }
    function showselectarea(){
        showselect.css({'display':'block'});
        showkeylist.css({'display':'none'});
    }
    function nextStep() {
        location.href = 'mems-pro-creat-2.html?position='+$('#serchkeywords').val();
    }
    function keysearch(key){
        var url  = _ip+'/hospital/getHospitalList';
        var data = {
            "chineseName": key
        }
        $.ajax({
            url:url,
            type : "POST",
            dataType: 'json',
            contentType:'application/json',
            data:JSON.stringify(data),
            success:function(data){
                if(data.success){
                    var h = '';
                    var data = data.data;
                    if(data && data.length){
                        for(var k = 0, kk = data.length; k < kk ;k ++){
                            h += '<li>西南区／'+data[k].province+'／'+data[k].city+'／'+data[k].chineseName+'</li>';
                        }
                        $('#keyul').html(h);
                    }else{
                        $('#keyul').html('没有匹配到！');
                    }
                    
                }else{
                    alert('上传失败, 请稍后重试！');
                }
            }
        })
   }
   $('#keyul').on('click','li',function(){
        $('#serchkeywords').val($(this).text() );
   })
</script>
</body>
</html>