<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>pm-需求-列表</title>
        <link href="../css/mems-index.css" type="text/css" rel="stylesheet"/>
    </head>
<body>
<!--header-->
<header id="header" class="header" v-html="datas">
    <div>{{datas}}</div>
</header>

<!--menu-->
<aside id="aside" class="aside" v-html="datas">
    <div>{{datas}}</div>
</aside>
<!-- <aside class="aside">
    <div class="logo">
        运营平台
    </div>
    <ul class="menu">
        <li>
            <div class="menu-first"><i class="dash"></i>Dashboard<l></l></div>
        </li>
        <li>
            <div class="menu-first" ><i class="project"></i>项目管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="mems-pro-list.html">项目列表</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="need"></i>需求管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="pm-need-list.html" >需求池</a></dd>
                <dd><a href="pm-bug-list.html">缺陷池</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first current"><i class="system"></i>系统配置<l></l></div>
            <dl class="menu-second">
                <dd><a href="user-manage.html" >用户管理</a></dd>
                <dd><a href="organize-architecture.html" >组织架构</a></dd>
                <dd><a href="tag-manage.html" class="current">标签管理</a></dd>
            </dl>
        </li>
        <li>
            <div class="menu-first"><i class="project"></i>文档管理<l></l></div>
            <dl class="menu-second">
                <dd><a href="doc-manage.html">文档管理</a></dd>
            </dl>
        </li>
    </ul>
</aside> -->


<!--content-->
<div class="content">
    <div class="page-header">
        <div class="header-info"><i></i><a href="pm-need-list-mems.html">需求池</a></div>
    </div>
    <div class="page-inner" style="padding-top: 13px">
        <ul class="item-tab clear">
            <li><a class="current" href="pm-need-list.html">原始需求</a></li>
            <li><a href="pm-need-list-mems.html">产品需求</a></li>
        </ul>
        <div class="commit-new-item"><a href="pm-need-commite.html" class="btn" style="width: 120px">创建原始需求&nbsp;<b>+</b></a></div>

        <table class="mems-search">
            <tr>
                <td>需求来源：<select id="needSource"></select></td>
                <td>需求名称：<input id="needName" /></td>
                <td>紧急程度：<select id="levelList"></select></td>
                <td>处理状态：<select id="status"></select></td>

                <td align="right"><button class="btn" id="checkout">查询</button></td>
            </tr>
        </table>

        <div class="item-content">
            <div class="table-box">
                <table>
                    <thead>
                        <tr class="odd">
                            <th>序号</th>
                            <th>需求来源</th>
                            <th>需求方</th>
                            <th>需求名称</th>
                            <th>紧急程度</th>
                           <!--  <th>附件</th> -->
                            <th>提出人</th>
                            <th>提出时间</th>
                            <th>处理状态</th>
                            <th>关联产品需求数</th>
                        </tr>
                    </thead>
                    <tbody id="bodyList">
                        
                    </tbody>
                </table>
            </div>
            <div class="pages clear">
                <div class="page-list clear" id="pageList">
                
                </div>
            </div>
        </div>
    </div>

</div>
<script src="../js/jquery.min.js"></script>
<script src="../js/vue.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript">
    // getNeedSource('needSource',0,true);
    _API.getNeedSource('needSource',0,true)
        .getLevelList('levelList',0,true)
        .getStatusList('status',0,true);

    function getData(p,checPara){
        var PerPage = 20;
        var url  = _ip+'/original/getRequireList?page='+p+'&size='+PerPage;
        var data = checPara || {};
        $.ajax({
            url:url,
            type : "POST",
            dataType: 'json',
            contentType:'application/json',
            data:JSON.stringify(data),
            success:function(json){
                if(!json.data || json.data.length <= 0){
                    $('#bodyList').html('<tr><td colspan="9">暂无数据！</td></tr>');
                    $('#pageList').html('');
                    return false;
                }
                var _data     = [];
                var _pager    = [];
                var totalPage = json.totlePage;
                var prev      = p-1;
                if(prev < 1)prev = 1;
                var next = p + 1;
                if(next > totalPage)next = totalPage;
                for(var k = 0, kk = json.data.length; k < kk; k++){
                    var msg = json.data[k];

                    _data.push('<tr>');
                    _data.push('<td>'+(k+1)+'</td>');
                    _data.push('<td>'+msg.projectName+'</td>');
                    _data.push('<td>'+msg.customerName+'</td>');
                    _data.push('<td><a href="pm-need-detail-mems.html?id='+msg.id+'" title="'+msg.name+'" class="link">'+(msg.name.length<12?msg.name:msg.name.substring(0,12)+'...' )+'</a></td>');
                    _data.push('<td>'+msg.level+'</td>');
                    _data.push('<td>'+msg.creater+'</td>');
                    _data.push('<td>'+msg.createTime+'</td>');
                    _data.push('<td>'+msg.status+'</td>');
                    _data.push('<td>'+msg.downRelationCount+'/'+msg.relationCount+'</td>');
                }
                _pager.push('<span>共：'+ totalPage +'页</span>');
                _pager.push('<span>您正在第：'+p+'页</span>')
                _pager.push('<a href="javascript:;" class="page-pre" onclick="getData('+prev+');return !1;">上一页</a>');
                _pager.push('<a href="javascript:;" class="page-next" onclick="getData('+next+');return !1;">下一页</a>');
                _pager.push('<span>前往第</span>');
                _pager.push('<input type="text" id="goToPage"/>');
                _pager.push('<span>页</span>');

                $('#bodyList').html(_data.join(""));
                $('#pageList').html(_pager.join(""));
                $('#goToPage').bind('keyup', function(event) {
                    if (event.keyCode == "13") {
                        
                        var v = parseInt($(this).val());
                        if(!/^[1-9]\d*$/.test(v)){
                            return false;
                        }else{
                            if(v <= 1){
                                getData(1);
                            }
                            else if(v >= totalPage){
                                getData(totalPage);
                            }else{
                                getData(v);
                            }
                        }

                    }
                });

            }
        })
    }
    getData(1);

    $('#checkout').on('click',function(){
        var para = {  
            projectId: $('#needSource').val() || null,
            name: $('#needName').val() || null,
            level:$('#levelList').val() || null,
            status:$('#status').val() || null,
        }
        getData(1,para);
    })

</script>
</body>
</html>